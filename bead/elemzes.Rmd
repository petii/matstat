---
title: "Statisztikai Elemzés"
author: "Vida Péter"
date: "16 May 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Adatok
Az adataink a `data/Pokemon.csv` fájl tartalmazza. Soronként egy-egy pokémonról a következőket tudjuk:

* Name: a neve
* Type.1: az elsődleges típusa
* Type.2: a másodlagos típusa (lehet üres is)
* Total: az alábbi [tulajdonágok](https://bulbapedia.bulbagarden.net/wiki/Statistic) összege:
  + HP: életerő pontok
  + Attack: támadóérték
  + Defense: védelmi érték
  + Sp..Atk: speciális támadás
  + Sp..Def: speciális védekezés
  + Speed: sebesség
* Generation: melyik generációból való.
* Legendary: legendás pokémon-e

```{r}
data <- read.csv('data/Pokemon.csv')
labels(data)[2]
```

Az eredeti adathalmazban van egy sorszám oszlop is, de mivel az R dataframe sorszámozza a sorokat, ez redundáns információ.

```{r}
data <- data[,c(2:length(data))]
```

Az adatok közül nem vettem figyelembe a pokémonok [mega evolúcióját](https://bulbapedia.bulbagarden.net/wiki/Mega_Evolution), mivel ez egy ideiglenes állapot. Ez `r length(data[grepl("Mega",data$Name),])` sor törlését jelentette.

```{r}
data <- data[!grepl("Mega",data$Name),]
```

A [legendás pokémonok](https://bulbapedia.bulbagarden.net/wiki/Legendary_Pokémon) nagytöbbségében jobb tulajdonságokkal rendelkeznek, így az adathalmazunkat érdemes szétválasztani.

```{r}
legendsplit <- split(data,data$Legendary)
normal <- legendsplit$False
legendary <- legendsplit$True
```

Így a normális és a legendás pokémonok számának megoszlása: `r length(normal$Name)` és `r length(legendary$Name)`.

# Normális és legendás pokémonok közti különbségek

## Tulajdonságok

```{r}
layout(matrix(c(1,1,1,2,4,6,3,5,7),3,3))
labels <- c('Normal','Legendary')
labels.short <- c('L','N')
boxplot(normal$Total,legendary$Total,main="Total",names = labels)
boxplot(legendary$HP,normal$HP,main="HP",names = labels.short,horizontal = TRUE)
boxplot(legendary$Attack,normal$Attack,main="Attack",names = labels.short,horizontal = TRUE)
boxplot(legendary$Defense,normal$Defense,main="Defense",names = labels.short,horizontal = TRUE)
boxplot(legendary$Speed,normal$Speed,main="Speed",names = labels.short,horizontal = TRUE)
boxplot(legendary$Sp..Atk,normal$Sp..Atk,main="Special Attack",names = labels.short,horizontal = TRUE)
boxplot(legendary$Sp..Def,normal$Sp..Def,main="Special Defense",names = labels.short,horizontal = TRUE)
```

Ez alapján azt láthatjuk, hogy többségében a legendás pokémonok jobb tulajdonsagokkal rendelkeznek a normálisakkal szemben.

### Eloszlások

Tudjuk, hogy a legendás pokémonok tulajdonságai alapvetően magasabb értékűek a normális pokémonokénál. De vajon van-e hasonlóság abban, hogy az adott intervallumaikukon hogyan oszlanak el?

Ehhez a különböző tulajdonságok átlagát transzformáljuk valamely közös pontba, mondjuk legyen a $0$. Majd kétmintás Kolmogorov-Szmirnov próbával teszteljük az eloszlások hasonlóságát, $95\%$-os szignifikancia szint mellett.

```{r}
tests.ks <- list()

for (i in c('HP','Attack','Defense','Speed','Sp..Atk','Sp..Def')) {
  layout(matrix(c(1:2),1,2,byrow = TRUE))
  tmp.norm <- normal[[i]] - mean(normal[[i]])
  tmp.legend <- legendary[[i]] - mean(legendary[[i]])
  dens.norm <- density(tmp.norm)
  dens.leg <- density(tmp.legend)
  limits.x <- c(min(min(tmp.norm),min(tmp.legend)),max(max(tmp.norm),max(tmp.legend)))
  limits.y <- c(0,max(max(dens.norm$y),max(dens.leg$y)))
  #layout(matrix(c(1,2),1,2,byrow = FALSE))
  #hist(tmp.norm,freq = FALSE,xlim = limits.x, ylim = limits.y,main = i,xlab = '')
  plot(dens.norm,xlim = limits.x, ylim = limits.y,main = i,xlab = '')
  #hist(tmp.legend,freq = FALSE,xlim = limits.x, ylim = limits.y,add=T,border = 2)
  lines(dens.leg,col = 2)
  plot(ecdf(tmp.norm),main='Tapasztalati eloszlásfüggvények')
  plot(ecdf(tmp.legend),add=TRUE,col=2)
  
  tests.ks[[i]] <- ks.test(tmp.norm,tmp.legend)
}

ks.value <- function(alpha,n,m) {
  sqrt(-1/2*log(alpha/2)) * sqrt((n+m)/(n*m))
}

#tests.f
alpha = 0.05
c <- ks.value(alpha,length(normal$Name),length(legendary$Name))
```

$95\%$-os szignifikancia szint mellett a kritikus tartomány: $|t| > `r c`$.

* Életerő
  + A próba statisztika értéke $`r tests.ks$HP$statistic` < `r c`$, tehát nem vetettük el a nullhipotézist.
* Támadás  
  + A próba statisztika értéke $`r tests.ks$Attack$statistic` < `r c`$, tehát nem vetettük el a nullhipotézist.
* Védekezés
  + A próba statisztika értéke $`r tests.ks$Defense$statistic` < `r c`$, tehát nem vetettük el a nullhipotézist.
* Sebesség
  + A próba statisztika értéke $`r tests.ks$Speed$statistic` > `r c`$, tehát elvetettük a nullhipotézist.
* Speciális Támadás
  + A próba statisztika értéke $`r tests.ks$Sp..Atk$statistic` < `r c`$, tehát nem vetettük el a nullhipotézist.
* Speciális Védekezés
  + A próba statisztika értéke $`r tests.ks$Sp..Def$statistic` < `r c`$, tehát nem vetettük el a nullhipotézist.

## Típusok

A pokémonoknak legalább egy és maximum két típusa lehet. A típusnak a támadásoknál van szerepe, a különféle képességek más más típusra máshogy hathatnak. ("It's super effective!")
Mivel a két típussal rendelkező pokémonok mindkét típusuknak megfelelően erősebbek és gyengébbek a más típusokkal szemben, a típus szerinti összegzésbe mindkét típus szerint beleszámoltam őket. Az adatok összessége így több mint az eredeti, de talán átfogóbb képet kaphatunk.

### Másodlagos típus

Először az elsődleges és másodlagos típusok megoszlásást külön a normális és a legendás pokémonok között vizsgáltam.

```{r}
norm.type1.summary <- summary(normal$Type.1)
norm.type2.summary <- summary(normal$Type.2)[-1]
norm.types.summary <- t(cbind(as.matrix(norm.type1.summary),as.matrix(norm.type2.summary)))
norm.types.summary.normaled <- norm.types.summary/sum(norm.types.summary)
norm.types.summary.normaled.ordered <- norm.types.summary.normaled[,order(colSums(norm.types.summary.normaled),decreasing = TRUE)]
leg.type1.summary <- summary(legendary$Type.1)
leg.type2.summary <- summary(legendary$Type.2)[-1]
leg.types.summary <- t(cbind(as.matrix(leg.type1.summary),as.matrix(leg.type2.summary)))
leg.types.summary.normaled <- leg.types.summary/sum(leg.types.summary)
leg.types.summary.normaled.ordered <- leg.types.summary.normaled[,order(colSums(leg.types.summary.normaled),decreasing = TRUE)]
types.summary <- cbind(colSums(norm.types.summary),colSums(leg.types.summary))
types.summary.normaled <- cbind(types.summary[,1]/sum(types.summary[,1]),types.summary[,2]/sum(types.summary[,2]))

maxval <- max(max(colSums(norm.types.summary.normaled)),max(colSums(leg.types.summary.normaled)))
maxval <- c(0,maxval)

label.x <- 'Density'
legendtext.1 <- c('Type.1','Type.2')

layout(matrix(c(1,2),1,2,byrow = TRUE))
barplot(norm.types.summary.normaled.ordered,las=1,horiz = TRUE,legend.text = legendtext.1,main = 'Types in normal pokemons',xlab = label.x)
barplot(leg.types.summary.normaled.ordered,las=1,horiz = TRUE,xlim = maxval,legend.text = legendtext.1,main = 'Types in legendary pokemons',xlab = label.x)
```

```{r} 
num.water <- sum(norm.types.summary[,colnames(norm.types.summary)=='Water'])
num.normal <- sum(norm.types.summary[,colnames(norm.types.summary)=='Normal'])
num.sum <- sum(norm.types.summary)
```

* A repülő típus főleg másodlagosként szerepel
* Normális pokémonoknál a legyakoribb típus a víz, de ez `r num.water` darabot jelent, míg a második leggyakoribb, a "Normal" `r num.normal` darab (az `r num.sum`-ből), ez pedig nem tekinthető szignifikáns különbségnek (`r abs(num.water-num.normal)/num.sum*100`%).
* Legendás pokémonoknál jellemzőbbnek tűnik a második típus megléte. 
  + A legendás pokémonoknak `r sum(leg.type2.summary)/length(legendary$Type.2)*100`%-a,
  + Ezzel szemben a normálisoknak `r sum(norm.type2.summary)/length(normal$Type.2)*100`%-a
  rendelkezik másodlagos típussal

```{r}
layout(matrix(1,1,1))
barplot(t(types.summary.normaled),beside = TRUE,las = 2,legend.text = labels)
```

Észrevehető, hogy legendás pokémonok gyakrabban sárkány, repülő illetve psychic típusúak.

# Generáció szerinti bontás
 
```{r}
gens <- split(data,data$Generation)
```

## Tulajdonságok

```{r}
for (i in gens) {
  hist(i$Total)
}
```

## Típusok